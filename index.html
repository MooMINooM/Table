<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô ‡πÇ‡∏ô‡∏ô‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå ‡πÄ‡∏Å‡∏°‡∏™‡πå 2568 (V.30 Final Scheduler)</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
    :root { 
        --primary: #1e3a8a; --bg: #f3f4f6; --text: #1f2937; 
        --fb: #3b82f6; --vb: #f97316; --tk: #10b981; --pt: #8b5cf6;
    }
    body { font-family: 'Sarabun', sans-serif; background: var(--bg); margin: 0; padding: 15px; padding-bottom: 80px; color: var(--text); }
    .container { max-width: 1200px; margin: 0 auto; }
    
    .header { text-align: center; margin-bottom: 20px; background: var(--primary); color: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
    
    /* Navigation */
    .nav-tabs { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; margin-bottom: 10px; }
    .nav-btn { background: white; border: 1px solid #ddd; padding: 8px 16px; border-radius: 50px; cursor: pointer; white-space: nowrap; transition: 0.2s; }
    .nav-btn.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.2); }

    .sub-tabs { display: flex; gap: 6px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 20px; border-bottom: 1px solid #ddd; }
    .sub-btn { background: #e0f2fe; border: none; padding: 6px 12px; border-radius: 15px; font-size: 0.9em; cursor: pointer; color: #0284c7; white-space: nowrap; }
    .sub-btn.active { background: #0284c7; color: white; font-weight: bold; }

    /* Match Layout */
    .timeline-block { margin-bottom: 30px; }
    .timeline-header { 
        background: #dbeafe; color: #1e40af; padding: 8px 15px; border-radius: 8px; 
        font-weight: bold; margin-bottom: 10px; display: inline-block; font-size: 1.1em; 
    }
    
    .matches-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 12px; }
    
    .match-card {
        background: white; border-radius: 10px; padding: 12px; 
        box-shadow: 0 2px 4px rgba(0,0,0,0.05); border-left: 5px solid #ccc; position: relative;
    }
    
    /* Sport Borders */
    .b-FB { border-left-color: var(--fb); }
    .b-VB { border-left-color: var(--vb); }
    .b-TK { border-left-color: var(--tk); }
    .b-PT { border-left-color: var(--pt); }
    .b-AT { border-left-color: #ef4444; background: #fff1f2; }
    .b-EV { border-left-color: #ec4899; background: #fdf2f8; }

    .card-top { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.85em; color: #666; }
    .field-label { background: #f3f4f6; padding: 2px 8px; border-radius: 4px; font-weight: bold; }
    
    .match-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; font-weight: 600; }
    .team-name { width: 40%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .team-left { text-align: right; } .team-right { text-align: left; }
    
    .score-inputs { display: flex; align-items: center; gap: 5px; background: #f8fafc; padding: 4px; border-radius: 6px; border: 1px solid #e2e8f0; }
    input[type="number"] { width: 35px; border: none; background: transparent; text-align: center; font-weight: bold; color: var(--primary); font-size: 1.1em; }
    
    .card-btm { font-size: 0.8em; color: #888; display: flex; justify-content: space-between; }
    .cat-tag { background: #eee; padding: 2px 6px; border-radius: 4px; }

    /* Control Panel */
    .control-panel { position: fixed; bottom: 20px; right: 20px; display: flex; gap: 10px; z-index: 1000; }
    .action-btn { width: 50px; height: 50px; border-radius: 50%; border: none; color: white; font-size: 1.2em; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
    .btn-save { background: #10b981; } .btn-reset { background: #ef4444; }
    
    #toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 2px; padding: 16px; position: fixed; z-index: 9999; left: 50%; bottom: 30px; transform: translateX(-50%); }
    #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }

    @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
    @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
</style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>üèÜ ‡πÇ‡∏ô‡∏ô‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå ‡πÄ‡∏Å‡∏°‡∏™‡πå 2568</h2>
        <small>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏Ç‡πà‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏£‡∏¥‡∏á: ‡∏ö‡∏≠‡∏•‡πÉ‡∏´‡∏ç‡πà 1 ‡∏ä‡∏°. | ‡∏ö‡∏≠‡∏•‡πÄ‡∏î‡πá‡∏Å 30 ‡∏ô‡∏≤‡∏ó‡∏µ</small>
    </div>

    <div class="nav-tabs">
        <button class="nav-btn active" onclick="switchTab('day1')">üìÖ 16 ‡∏ò.‡∏Ñ.</button>
        <button class="nav-btn" onclick="switchTab('day2')">üìÖ 17 ‡∏ò.‡∏Ñ.</button>
        <button class="nav-btn" onclick="switchTab('day3')">üìÖ 18 ‡∏ò.‡∏Ñ.</button>
        <button class="nav-btn" onclick="switchTab('day4')">üìÖ 19 ‡∏ò.‡∏Ñ.</button>
        <button class="nav-btn" onclick="switchTab('standings')">üìä ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
    </div>

    <div id="sub-filter" class="sub-tabs">
        <button class="sub-btn active" onclick="setFilter('ALL')">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        <button class="sub-btn" onclick="setFilter('FB')">‚öΩ ‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏•</button>
        <button class="sub-btn" onclick="setFilter('VB')">üèê ‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå</button>
        <button class="sub-btn" onclick="setFilter('TK')">üß∂ ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠</button>
        <button class="sub-btn" onclick="setFilter('PT')">üîò ‡πÄ‡∏õ‡∏ï‡∏≠‡∏á</button>
        <button class="sub-btn" onclick="setFilter('AT')">üèÉ ‡∏Å‡∏£‡∏µ‡∏ë‡∏≤</button>
    </div>

    <div id="content-area"></div>
</div>

<div id="toast">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß ‚úÖ</div>

<div class="control-panel">
    <button class="action-btn btn-save" onclick="saveDataManual()" title="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å"><i class="fas fa-save"></i></button>
    <button class="action-btn btn-reset" onclick="resetData()" title="‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï"><i class="fas fa-trash"></i></button>
</div>

<script>
    // --- 1. CONFIG: Teams & Categories ---
    const secTeams = ["‡∏´‡∏ô‡∏≠‡∏á‡∏Å‡∏∏‡∏á‡∏®‡∏£‡∏µ‡∏Ø", "‡∏†‡∏π‡∏û‡∏£‡∏∞‡∏Ø", "‡πÇ‡∏ô‡∏ô‡∏°‡πà‡∏ß‡∏á", "‡πÇ‡∏ô‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á"];
    // 9 ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°)
    const teams9 = {
        A: ["‡πÇ‡∏ô‡∏ô‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå‡∏Ø", "‡∏ó‡πà‡∏≤‡∏≠‡∏∏‡∏ó‡∏±‡∏¢", "‡∏†‡∏π‡∏û‡∏£‡∏∞‡∏Ø"],
        B: ["‡πÇ‡∏ô‡∏ô‡∏™‡∏ß‡∏≤‡∏ó‡∏Ø", "‡∏´‡∏ô‡∏≠‡∏á‡∏Å‡∏∏‡∏á‡∏®‡∏£‡∏µ‡∏Ø", "‡πÇ‡∏ô‡∏ô‡πÑ‡∏´‡∏°‡∏Ø"],
        C: ["‡∏î‡πâ‡∏ß‡∏á‡∏Ø-‡∏ä‡∏≥‡∏Ø", "‡πÇ‡∏ô‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á", "‡πÇ‡∏ô‡∏ô‡∏°‡πà‡∏ß‡∏á"]
    };
    
    // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á 20 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
    const categories = [
        { id:"FB_ANU_M", sp:"FB", lv:"ANU", gd:"M", n:"‡∏ö‡∏≠‡∏•‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• ‡∏ä‡∏≤‡∏¢" },
        { id:"FB_ANU_F", sp:"FB", lv:"ANU", gd:"F", n:"‡∏ö‡∏≠‡∏•‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• ‡∏´‡∏ç‡∏¥‡∏á" },
        { id:"FB_P13_M", sp:"FB", lv:"P13", gd:"M", n:"‡∏ö‡∏≠‡∏• ‡∏õ.1-3 ‡∏ä‡∏≤‡∏¢" },
        { id:"FB_P13_F", sp:"FB", lv:"P13", gd:"F", n:"‡∏ö‡∏≠‡∏• ‡∏õ.1-3 ‡∏´‡∏ç‡∏¥‡∏á" },
        { id:"FB_P46_M", sp:"FB", lv:"P46", gd:"M", n:"‡∏ö‡∏≠‡∏• ‡∏õ.4-6 ‡∏ä‡∏≤‡∏¢" },
        { id:"FB_P46_F", sp:"FB", lv:"P46", gd:"F", n:"‡∏ö‡∏≠‡∏• ‡∏õ.4-6 ‡∏´‡∏ç‡∏¥‡∏á" },
        { id:"FB_SEC_M", sp:"FB", lv:"SEC", gd:"M", n:"‡∏ö‡∏≠‡∏•‡∏°‡∏±‡∏ò‡∏¢‡∏° ‡∏ä‡∏≤‡∏¢" },
        { id:"FB_SEC_F", sp:"FB", lv:"SEC", gd:"F", n:"‡∏ö‡∏≠‡∏•‡∏°‡∏±‡∏ò‡∏¢‡∏° ‡∏´‡∏ç‡∏¥‡∏á" },
        
        { id:"VB_P46_M", sp:"VB", lv:"P46", gd:"M", n:"‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå ‡∏õ.4-6 ‡∏ä‡∏≤‡∏¢" },
        { id:"VB_P46_F", sp:"VB", lv:"P46", gd:"F", n:"‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå ‡∏õ.4-6 ‡∏´‡∏ç‡∏¥‡∏á" },
        { id:"VB_SEC_M", sp:"VB", lv:"SEC", gd:"M", n:"‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå ‡∏°‡∏±‡∏ò‡∏¢‡∏° ‡∏ä‡∏≤‡∏¢" },
        { id:"VB_SEC_F", sp:"VB", lv:"SEC", gd:"F", n:"‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå ‡∏°‡∏±‡∏ò‡∏¢‡∏° ‡∏´‡∏ç‡∏¥‡∏á" },

        { id:"TK_P46_M", sp:"TK", lv:"P46", gd:"M", n:"‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠ ‡∏õ.4-6 ‡∏ä‡∏≤‡∏¢" },
        { id:"TK_P46_F", sp:"TK", lv:"P46", gd:"F", n:"‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠ ‡∏õ.4-6 ‡∏´‡∏ç‡∏¥‡∏á" },
        { id:"TK_SEC_M", sp:"TK", lv:"SEC", gd:"M", n:"‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠ ‡∏°‡∏±‡∏ò‡∏¢‡∏° ‡∏ä‡∏≤‡∏¢" },
        { id:"TK_SEC_F", sp:"TK", lv:"SEC", gd:"F", n:"‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠ ‡∏°‡∏±‡∏ò‡∏¢‡∏° ‡∏´‡∏ç‡∏¥‡∏á" },

        { id:"PT_P46_M", sp:"PT", lv:"P46", gd:"M", n:"‡πÄ‡∏õ‡∏ï‡∏≠‡∏á ‡∏õ.4-6 ‡∏ä‡∏≤‡∏¢" },
        { id:"PT_P46_F", sp:"PT", lv:"P46", gd:"F", n:"‡πÄ‡∏õ‡∏ï‡∏≠‡∏á ‡∏õ.4-6 ‡∏´‡∏ç‡∏¥‡∏á" },
        { id:"PT_SEC_M", sp:"PT", lv:"SEC", gd:"M", n:"‡πÄ‡∏õ‡∏ï‡∏≠‡∏á ‡∏°‡∏±‡∏ò‡∏¢‡∏° ‡∏ä‡∏≤‡∏¢" },
        { id:"PT_SEC_F", sp:"PT", lv:"SEC", gd:"F", n:"‡πÄ‡∏õ‡∏ï‡∏≠‡∏á ‡∏°‡∏±‡∏ò‡∏¢‡∏° ‡∏´‡∏ç‡∏¥‡∏á" }
    ];

    let matches = [];
    let currentTab = 'day1';
    let currentFilter = 'ALL';

    // --- 2. SCHEDULER ENGINE ---
    function generateSchedule() {
        let generated = [];
        
        // 2.1 Fixed Events
        generated.push(
            { id:"AT1", d:"day1", t:"08.30", f:"‡∏•‡∏π‡πà‡∏ß‡∏¥‡πà‡∏á", sp:"AT", lv:"ALL", desc:"üèÉ ‡∏ß‡∏¥‡πà‡∏á 80‡∏°. (‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•/‡∏õ.‡∏ï‡πâ‡∏ô)", t1:"-", t2:"-" },
            { id:"AT2", d:"day1", t:"09.30", f:"‡∏•‡∏π‡πà‡∏ß‡∏¥‡πà‡∏á", sp:"AT", lv:"ALL", desc:"üèÉ ‡∏ß‡∏¥‡πà‡∏á 100‡∏°. (‡∏õ.‡∏õ‡∏•‡∏≤‡∏¢/‡∏°‡∏±‡∏ò‡∏¢‡∏°)", t1:"-", t2:"-" },
            { id:"AT3", d:"day1", t:"10.30", f:"‡∏•‡∏π‡πà‡∏ß‡∏¥‡πà‡∏á", sp:"AT", lv:"ALL", desc:"üèÉ ‡∏ß‡∏¥‡πà‡∏á‡∏ú‡∏•‡∏±‡∏î 4x80‡∏°.", t1:"-", t2:"-" },
            { id:"AT4", d:"day1", t:"11.30", f:"‡∏•‡∏π‡πà‡∏ß‡∏¥‡πà‡∏á", sp:"AT", lv:"ALL", desc:"üèÉ ‡∏ß‡∏¥‡πà‡∏á‡∏ú‡∏•‡∏±‡∏î 4x100‡∏°.", t1:"-", t2:"-" },
            { id:"EV1", d:"day2", t:"08.00", f:"‡∏™‡∏ô‡∏≤‡∏°‡∏Å‡∏•‡∏≤‡∏á", sp:"EV", lv:"ALL", desc:"üè≥Ô∏è‚Äçüåà ‡∏Ç‡∏ö‡∏ß‡∏ô‡∏û‡∏≤‡πÄ‡∏´‡∏£‡∏î", t1:"-", t2:"-" },
            { id:"EV2", d:"day2", t:"09.00", f:"‡∏™‡∏ô‡∏≤‡∏°‡∏Å‡∏•‡∏≤‡∏á", sp:"EV", lv:"ALL", desc:"üéà ‡∏û‡∏¥‡∏ò‡∏µ‡πÄ‡∏õ‡∏¥‡∏î", t1:"-", t2:"-" }
        );

        // 2.2 Field Queues (Start Times)
        // Day 1: 13:00-17:00, Day 2: 13:00-17:00, Day 3: 08:30-17:00
        let queues = {
            FB1: { d:1, h:13, m:0 }, FB2: { d:1, h:13, m:0 }, FB3: { d:1, h:13, m:0 }, // Big Fields
            FBA: { d:1, h:13, m:0 }, // Anu Field
            VB1: { d:1, h:13, m:0 }, VB2: { d:1, h:13, m:0 },
            TK1: { d:1, h:13, m:0 },
            PT1: { d:1, h:13, m:0 }, PT2: { d:1, h:13, m:0 }
        };

        const advanceTime = (q, durationMins) => {
            q.m += durationMins;
            while(q.m >= 60) { q.m -= 60; q.h++; }
            
            // Day Breaks
            if(q.d === 1 && q.h >= 17) { q.d=2; q.h=13; q.m=0; }
            if(q.d === 2 && q.h >= 17) { q.d=3; q.h=8; q.m=30; }
            // Day 4 reserved for Finals
        };

        const getField = (sp, lv) => {
            if(sp==='FB') {
                if(lv==='ANU') return {q: queues.FBA, name:'‡∏™‡∏ô‡∏≤‡∏°‡πÄ‡∏î‡πá‡∏Å', dur:30};
                // Rotate big fields
                let q1=queues.FB1, q2=queues.FB2, q3=queues.FB3;
                // Simple load balancing
                if(compareTime(q1,q2)<=0 && compareTime(q1,q3)<=0) return {q:q1, name:'‡∏™‡∏ô‡∏≤‡∏° 1', dur:60};
                if(compareTime(q2,q3)<=0) return {q:q2, name:'‡∏™‡∏ô‡∏≤‡∏° 2', dur:60};
                return {q:q3, name:'‡∏™‡∏ô‡∏≤‡∏° 3', dur:60};
            }
            if(sp==='VB') return (compareTime(queues.VB1, queues.VB2)<=0) ? {q:queues.VB1, name:'‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå 1', dur:45} : {q:queues.VB2, name:'‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå 2', dur:45};
            if(sp==='TK') return {q:queues.TK1, name:'‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠ 1', dur:40};
            if(sp==='PT') return (compareTime(queues.PT1, queues.PT2)<=0) ? {q:queues.PT1, name:'‡πÄ‡∏õ‡∏ï‡∏≠‡∏á 1', dur:45} : {q:queues.PT2, name:'‡πÄ‡∏õ‡∏ï‡∏≠‡∏á 2', dur:45};
            return null;
        };

        const compareTime = (a, b) => (a.d*10000 + a.h*100 + a.m) - (b.d*10000 + b.h*100 + b.m);
        const formatTime = (t) => `${t.h.toString().padStart(2,'0')}.${t.m.toString().padStart(2,'0')}`;

        // 2.3 Generate & Schedule Matches
        let allPairings = [];

        categories.forEach(cat => {
            let pairings = [];
            if(cat.lv === 'SEC') {
                // League (4 Teams) - Single Round Robin (6 matches) to fit schedule
                let t = secTeams;
                pairings.push({t1:t[0], t2:t[1], st:'‡∏•‡∏µ‡∏Å'}, {t1:t[2], t2:t[3], st:'‡∏•‡∏µ‡∏Å'});
                pairings.push({t1:t[0], t2:t[2], st:'‡∏•‡∏µ‡∏Å'}, {t1:t[1], t2:t[3], st:'‡∏•‡∏µ‡∏Å'});
                pairings.push({t1:t[0], t2:t[3], st:'‡∏•‡∏µ‡∏Å'}, {t1:t[1], t2:t[2], st:'‡∏•‡∏µ‡∏Å'});
            } else {
                // Groups (3 Groups x 3 Teams) = 9 matches
                // Use default teams9 structure but rotate for variety if needed
                ['A','B','C'].forEach(g => {
                    let t = teams9[g]; // Simplify: Use same pool for demo
                    pairings.push({t1:t[0], t2:t[1], st:`‡∏™‡∏≤‡∏¢ ${g}`}, {t1:t[1], t2:t[2], st:`‡∏™‡∏≤‡∏¢ ${g}`}, {t1:t[2], t2:t[0], st:`‡∏™‡∏≤‡∏¢ ${g}`});
                });
            }
            
            pairings.forEach((p, idx) => {
                allPairings.push({ ...p, cat:cat, idx:idx });
            });
        });

        // Sort pairings to mix sports (Interleave)
        // This prevents one sport from hogging early slots
        allPairings.sort((a,b) => (a.idx - b.idx));

        // Assign Slots
        allPairings.forEach(p => {
            let slotInfo = getField(p.cat.sp, p.cat.lv);
            if(slotInfo) {
                let dayStr = `day${slotInfo.q.d}`;
                let timeStr = formatTime(slotInfo.q);
                
                generated.push({
                    id: `${p.cat.id}_${p.idx}`,
                    d: dayStr, t: timeStr, f: slotInfo.name,
                    sp: p.cat.sp, lv: p.cat.lv, gd: p.cat.gd,
                    t1: p.t1, t2: p.t2, s1: "", s2: "", ref: "‡∏Å‡∏Å.", cat: p.st,
                    desc: `${p.cat.n} ${p.st}`
                });

                advanceTime(slotInfo.q, slotInfo.dur);
            }
        });

        // 2.4 Add Finals (Day 4)
        categories.forEach(cat => {
            generated.push({
                id: `FIN_${cat.id}`, d: 'day4', t: '09.00', f: '‡∏™‡∏ô‡∏≤‡∏°‡∏Å‡∏•‡∏≤‡∏á',
                sp: cat.sp, lv: cat.lv, gd: cat.gd, cat: '‡∏ä‡∏¥‡∏á‡∏ä‡∏ô‡∏∞‡πÄ‡∏•‡∏¥‡∏®',
                t1: '(‡∏£‡∏≠‡∏ä‡∏¥‡∏á)', t2: '(‡∏£‡∏≠‡∏ä‡∏¥‡∏á)', s1:'', s2:'', desc: `${cat.name} ‡∏ä‡∏¥‡∏á‡∏ä‡∏ô‡∏∞‡πÄ‡∏•‡∏¥‡∏®`
            });
        });

        return generated;
    }

    // --- 3. RENDER LOGIC ---
    document.addEventListener('DOMContentLoaded', () => {
        let d = localStorage.getItem('ns_v30_db');
        if(d) matches = JSON.parse(d);
        else { matches = generateSchedule(); saveData(); }
        renderPage();
    });

    function renderPage() {
        const container = document.getElementById('content-area');
        const subTabs = document.getElementById('sub-filter');
        
        if (currentTab === 'standings') {
            subTabs.style.display = 'none';
            renderStandings(container);
        } else {
            subTabs.style.display = 'flex';
            renderSchedule(container);
        }
    }

    function renderSchedule(container) {
        let dayMatches = matches.filter(m => m.d === currentTab);
        if(currentFilter !== 'ALL') dayMatches = dayMatches.filter(m => m.sp === currentFilter);
        dayMatches.sort((a,b) => a.t.localeCompare(b.t));

        let html = "";
        let times = [...new Set(dayMatches.map(m => m.t))];

        if(times.length === 0) html = `<div style="text-align:center; padding:40px; color:#888;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</div>`;

        times.forEach(t => {
            html += `<div class="timeline-block"><div class="timeline-header"><i class="far fa-clock"></i> ${t} ‡∏ô.</div><div class="matches-grid">`;
            dayMatches.filter(m => m.t === t).forEach(m => {
                let borderClass = `b-${m.sp}`;
                let win1 = (parseInt(m.s1) > parseInt(m.s2)) ? "color:#10b981;" : "";
                let win2 = (parseInt(m.s2) > parseInt(m.s1)) ? "color:#10b981;" : "";
                
                html += `
                <div class="match-card ${borderClass}">
                    <div class="card-top">
                        <span class="field-label">${m.f}</span>
                        <span>${m.sp === 'AT' || m.sp === 'EV' ? '' : m.lv + ' ' + m.gd}</span>
                    </div>
                    <div style="font-weight:bold; color:var(--primary); margin-bottom:5px;">${m.desc}</div>
                    
                    ${m.sp === 'AT' || m.sp === 'EV' ? '' : `
                    <div class="match-row">
                        <span class="team-name team-left" style="${win1}">${m.t1}</span>
                        <div class="score-inputs">
                            <input type="number" value="${m.s1}" onchange="upd('${m.id}',1,this.value)">:
                            <input type="number" value="${m.s2}" onchange="upd('${m.id}',2,this.value)">
                        </div>
                        <span class="team-name team-right" style="${win2}">${m.t2}</span>
                    </div>
                    <div class="card-btm">
                        <span class="cat-tag">${m.cat}</span>
                        <span>‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£: ${m.ref}</span>
                    </div>`}
                </div>`;
            });
            html += `</div></div>`;
        });
        container.innerHTML = html;
    }

    function renderStandings(container) {
        let html = "";
        categories.forEach(cat => {
            if(currentFilter !== 'ALL' && currentFilter !== cat.sp) return;
            // Check matches existence
            let hasMatches = matches.some(m => m.sp === cat.sp && m.lv === cat.lv && m.gd === cat.gd);
            if(!hasMatches) return;

            // Calculate Stats
            let stats = {};
            matches.forEach(m => {
                if(m.sp === cat.sp && m.lv === cat.lv && m.gd === cat.gd && m.s1 && m.s2) {
                    let s1 = parseInt(m.s1), s2 = parseInt(m.s2);
                    if(!stats[m.t1]) stats[m.t1] = {P:0, PTS:0};
                    if(!stats[m.t2]) stats[m.t2] = {P:0, PTS:0};
                    stats[m.t1].P++; stats[m.t2].P++;
                    if(s1>s2) stats[m.t1].PTS+=3;
                    else if(s2>s1) stats[m.t2].PTS+=3;
                    else { stats[m.t1].PTS+=1; stats[m.t2].PTS+=1; }
                }
            });

            // Display Table (Grouped by pool/league)
            // Simplified: Show combined table for category (or logic to split by A,B,C needed)
            let teams = Object.keys(stats).sort((a,b) => stats[b].PTS - stats[a].PTS);
            if(teams.length === 0) return;

            html += `<div style="margin-bottom:20px;">
                <h4 style="color:var(--primary); border-bottom:2px solid #ddd; padding-bottom:5px;">${cat.name}</h4>
                <table class="standing-table">
                    <tr><th>#</th><th>‡∏ó‡∏µ‡∏°</th><th>‡πÅ‡∏Ç‡πà‡∏á</th><th>‡πÅ‡∏ï‡πâ‡∏°</th></tr>
                    ${teams.map((t,i) => `<tr><td>${i+1}</td><td>${t}</td><td>${stats[t].P}</td><td class="pts-col">${stats[t].PTS}</td></tr>`).join('')}
                </table>
            </div>`;
        });
        container.innerHTML = html;
    }

    // --- Utilities ---
    function switchTab(t) { currentTab=t; document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active')); event.target.classList.add('active'); renderPage(); }
    function setFilter(f) { currentFilter=f; document.querySelectorAll('.sub-btn').forEach(b=>b.classList.remove('active')); event.target.classList.add('active'); renderPage(); }
    function upd(id, s, v) { let m = matches.find(x=>x.id===id); if(m){ if(s==1)m.s1=v; else m.s2=v; saveData(); } }
    function saveData() { localStorage.setItem('ns_v30_db', JSON.stringify(matches)); showToast(); }
    function saveDataManual() { saveData(); alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß'); }
    function resetData() { if(confirm('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) { localStorage.removeItem('ns_v30_db'); location.reload(); } }
    function showToast() { let t=document.getElementById('toast'); t.className='show'; setTimeout(()=>t.className='', 2000); }
</script>
</body>
</html>
