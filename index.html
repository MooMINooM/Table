<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard ‡πÇ‡∏ô‡∏ô‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå ‡πÄ‡∏Å‡∏°‡∏™‡πå 2568 (V.38 + Smart Logic)</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
    :root { 
        --header-h: 60px;
        --sidebar-w: 220px;
        --primary: #1e40af; --bg: #f1f5f9; --text: #1e293b; --white: #ffffff;
        --border: #e2e8f0; --accent: #f59e0b;
        --c-fb: #2563eb; --c-vb: #f97316; --c-tk: #059669; --c-pt: #7c3aed; --c-at: #db2777;
    }
    * { box-sizing: border-box; }
    body { font-family: 'Sarabun', sans-serif; background: var(--bg); margin: 0; padding: 0; color: var(--text); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
    
    /* HEADER */
    .app-header {
        height: var(--header-h); background: var(--white); border-bottom: 1px solid var(--border);
        display: flex; align-items: center; justify-content: space-between; padding: 0 20px;
        box-shadow: 0 1px 2px rgba(0,0,0,0.05); z-index: 10;
    }
    .app-title { font-size: 1.25rem; font-weight: 700; color: var(--primary); display: flex; align-items: center; gap: 10px; cursor: pointer; }
    
    .day-tabs { display: flex; gap: 5px; background: #e2e8f0; padding: 4px; border-radius: 8px; }
    .day-btn {
        border: none; background: transparent; padding: 6px 16px; border-radius: 6px;
        font-size: 0.9rem; cursor: pointer; color: #64748b; font-weight: 600; transition: 0.2s;
    }
    .day-btn:hover { background: #cbd5e1; color: #334155; }
    .day-btn.active { background: var(--white); color: var(--primary); box-shadow: 0 1px 2px rgba(0,0,0,0.1); }

    .actions { display: flex; gap: 10px; }
    .btn-icon { width: 36px; height: 36px; border-radius: 8px; border: 1px solid var(--border); background: var(--white); cursor: pointer; color: #64748b; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
    .btn-icon:hover { background: #eff6ff; color: var(--primary); border-color: var(--primary); }
    .btn-save { color: #10b981; border-color: #bbf7d0; background: #f0fdf4; }
    .btn-reset { color: #ef4444; border-color: #fecaca; background: #fef2f2; }

    /* LAYOUT */
    .main-container { flex: 1; display: flex; overflow: hidden; }

    /* SIDEBAR */
    .sidebar { width: var(--sidebar-w); background: var(--white); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 20px 15px; overflow-y: auto; }
    .menu-title { font-size: 0.75rem; text-transform: uppercase; color: #94a3b8; font-weight: 700; margin-bottom: 12px; letter-spacing: 0.5px; }
    .nav-item {
        display: flex; align-items: center; gap: 12px; padding: 10px 12px; margin-bottom: 4px;
        border-radius: 8px; cursor: pointer; font-weight: 500; color: #475569; transition: 0.2s;
    }
    .nav-item:hover { background: #f1f5f9; color: var(--primary); }
    .nav-item.active { background: #eff6ff; color: var(--primary); font-weight: 600; }
    .nav-icon { width: 24px; text-align: center; font-size: 1.1em; }

    /* CONTENT */
    .content-area { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 20px; scroll-behavior: smooth; }
    
    /* Welcome */
    .welcome-box { 
        display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; color: #475569; 
        animation: fadeIn 0.5s ease;
    }
    .welcome-icon { font-size: 5rem; color: var(--primary); margin-bottom: 20px; opacity: 0.8; }
    .welcome-title { font-size: 2rem; font-weight: 700; margin-bottom: 10px; color: #1e293b; }
    .welcome-text { font-size: 1.1rem; margin-bottom: 30px; max-width: 500px; line-height: 1.6; }
    .welcome-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; width: 100%; max-width: 600px; }
    .w-btn { 
        padding: 20px; background: white; border: 1px solid var(--border); border-radius: 12px; cursor: pointer; transition: 0.2s; 
        display: flex; flex-direction: column; align-items: center; gap: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .w-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 15px rgba(0,0,0,0.1); border-color: var(--primary); color: var(--primary); }
    .w-btn i { font-size: 2rem; }

    /* Schedule */
    .schedule-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; align-items: start; }
    .time-block { background: var(--white); border-radius: 12px; border: 1px solid var(--border); overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.05); break-inside: avoid; }
    .time-header { background: #f8fafc; padding: 8px 15px; border-bottom: 1px solid var(--border); font-weight: 700; color: #334155; display: flex; align-items: center; gap: 8px; font-size: 0.95rem; }
    
    .match-row { display: flex; align-items: center; padding: 12px 15px; border-bottom: 1px solid var(--border); position: relative; gap: 10px; font-size: 0.9rem; }
    .match-row:last-child { border-bottom: none; }
    .match-row::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; }
    .b-FB::before { background: var(--c-fb); } .b-VB::before { background: var(--c-vb); }
    .b-TK::before { background: var(--c-tk); } .b-PT::before { background: var(--c-pt); }
    .b-AT::before { background: var(--c-at); } .b-EV::before { background: #ec4899; }

    .m-info { flex: 1; display: flex; flex-direction: column; gap: 4px; }
    .m-cat { font-size: 0.75rem; color: #64748b; font-weight: 600; display: flex; gap: 6px; align-items: center; }
    .m-cat span { background: #e2e8f0; padding: 1px 6px; border-radius: 4px; }
    .m-vs { font-size: 0.95rem; font-weight: 600; color: #1e293b; display: flex; justify-content: space-between; align-items: center; }
    
    .score-box { display: flex; align-items: center; gap: 5px; background: #f1f5f9; padding: 2px 6px; border-radius: 6px; border: 1px solid #e2e8f0; }
    input[type="number"] { width: 30px; border: none; background: transparent; text-align: center; font-weight: 700; font-size: 1rem; color: var(--primary); padding: 0; }
    input:focus { outline: none; }

    /* RIGHT PANEL */
    .right-panel { width: 380px; background: var(--white); border-left: 1px solid var(--border); display: flex; flex-direction: column; overflow-y: auto; }
    .panel-header { padding: 15px; border-bottom: 1px solid var(--border); font-weight: 700; background: #f8fafc; }
    .standings-list { padding: 15px; display: flex; flex-direction: column; gap: 20px; }
    
    .st-box { border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
    .st-head { background: #f1f5f9; padding: 6px 10px; font-size: 0.8rem; font-weight: 700; color: #475569; border-bottom: 1px solid var(--border); }
    .st-table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
    .st-table td, .st-table th { padding: 6px; text-align: center; border-bottom: 1px solid #f1f5f9; }
    .st-table td:nth-child(2) { text-align: left; width: 45%; padding-left: 8px; }
    .st-pts { background: #eff6ff; color: var(--primary); font-weight: 700; }

    #toast { visibility: hidden; min-width: 200px; background-color: #1e293b; color: #fff; text-align: center; border-radius: 6px; padding: 12px; position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 9999; }
    #toast.show { visibility: visible; animation: fadein 0.3s, fadeout 0.3s 2.0s; }

    @media (max-width: 1200px) { .schedule-grid { grid-template-columns: 1fr; } }
    @media (max-width: 1024px) { .right-panel { display: none; } }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadein { from {bottom: 10px; opacity: 0;} to {bottom: 30px; opacity: 1;} }
    @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 10px; opacity: 0;} }
</style>
</head>
<body>

<header class="app-header">
    <div class="app-title" onclick="goHome()"><i class="fas fa-trophy"></i> ‡πÇ‡∏ô‡∏ô‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå ‡πÄ‡∏Å‡∏°‡∏™‡πå 2568</div>
    <div class="day-tabs">
        <button class="day-btn active" onclick="switchDay('day1')">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 1 (‡∏ö‡πà‡∏≤‡∏¢)</button>
        <button class="day-btn" onclick="switchDay('day2')">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 2 (‡∏ö‡πà‡∏≤‡∏¢)</button>
        <button class="day-btn" onclick="switchDay('day3')">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 3 (‡πÄ‡∏ï‡πá‡∏°‡∏ß‡∏±‡∏ô)</button>
        <button class="day-btn" onclick="switchDay('day4')">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 4 (‡πÄ‡∏ï‡πá‡∏°‡∏ß‡∏±‡∏ô)</button>
    </div>
    <div class="actions">
        <button class="btn-icon btn-save" title="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å" onclick="saveDataManual()"><i class="fas fa-save"></i></button>
        <button class="btn-icon btn-reset" title="‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà" onclick="resetData()"><i class="fas fa-redo-alt"></i></button>
    </div>
</header>

<div class="main-container">
    <aside class="sidebar">
        <div class="menu-title">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤</div>
        <div class="nav-item" onclick="filterSport('FB')"><span class="nav-icon" style="color:var(--c-fb)"><i class="fas fa-futbol"></i></span> ‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏•</div>
        <div class="nav-item" onclick="filterSport('VB')"><span class="nav-icon" style="color:var(--c-vb)"><i class="fas fa-volleyball-ball"></i></span> ‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå</div>
        <div class="nav-item" onclick="filterSport('TK')"><span class="nav-icon" style="color:var(--c-tk)"><i class="fas fa-baseball-ball"></i></span> ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠</div>
        <div class="nav-item" onclick="filterSport('PT')"><span class="nav-icon" style="color:var(--c-pt)"><i class="fas fa-bowling-ball"></i></span> ‡πÄ‡∏õ‡∏ï‡∏≠‡∏á</div>
        <div class="nav-item" onclick="filterSport('AT')"><span class="nav-icon" style="color:var(--c-at)"><i class="fas fa-running"></i></span> ‡∏Å‡∏£‡∏µ‡∏ë‡∏≤/‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</div>
    </aside>

    <main class="content-area" id="content-area">
        </main>

    <aside class="right-panel">
        <div class="panel-header"><i class="fas fa-chart-bar"></i> ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
        <div class="standings-list" id="standings-area">
            <div style="text-align:center; padding:40px; color:#94a3b8;">
                <i class="fas fa-chart-pie" style="font-size:3rem; margin-bottom:10px;"></i><br>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
            </div>
        </div>
    </aside>
</div>

<div id="toast">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ</div>

<script>
    // --- 1. CONFIGURATION & DATA ---
    let matches = [];
    let currentDay = 'day1';
    let currentMode = 'welcome';
    let currentSport = '';

    // ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ 9 ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏£‡∏¥‡∏á
    const schools = [
        { id: 'S1', name: "‡πÇ‡∏ô‡∏ô‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå‡∏Ø" },
        { id: 'S2', name: "‡∏ó‡πà‡∏≤‡∏≠‡∏∏‡∏ó‡∏±‡∏¢" },
        { id: 'S3', name: "‡∏†‡∏π‡∏û‡∏£‡∏∞‡∏Ø" },
        { id: 'S4', name: "‡πÇ‡∏ô‡∏ô‡∏°‡πà‡∏ß‡∏á" },
        { id: 'S5', name: "‡πÇ‡∏ô‡∏ô‡∏™‡∏ß‡∏≤‡∏ó‡∏Ø" },
        { id: 'S6', name: "‡∏´‡∏ô‡∏≠‡∏á‡∏Å‡∏∏‡∏á‡∏®‡∏£‡∏µ‡∏Ø" },
        { id: 'S7', name: "‡πÇ‡∏ô‡∏ô‡πÑ‡∏´‡∏°‡∏Ø" },
        { id: 'S8', name: "‡∏î‡πâ‡∏ß‡∏á‡∏Ø-‡∏ä‡∏≥‡∏Ø" },
        { id: 'S9', name: "‡πÇ‡∏ô‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á" }
    ];

    // ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏µ‡∏¨‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤
    const sportsConfig = [
        // Football (Field Separated)
        { id: 'FB_K', sp:'FB', lv:'‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•', name: '‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏• ‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•', field: '‡∏™‡∏ô‡∏≤‡∏°‡πÄ‡∏î‡πá‡∏Å (‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•)', duration: 30, type: 'group_9' },
        { id: 'FB_PL', sp:'FB', lv:'‡∏õ.‡∏ï‡πâ‡∏ô', name: '‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏• ‡∏õ.‡∏ï‡πâ‡∏ô', field: '‡∏™‡∏ô‡∏≤‡∏° 1 (‡∏õ.‡∏ï‡πâ‡∏ô)', duration: 45, type: 'group_9' },
        { id: 'FB_PH', sp:'FB', lv:'‡∏õ.‡∏õ‡∏•‡∏≤‡∏¢', name: '‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏• ‡∏õ.‡∏õ‡∏•‡∏≤‡∏¢', field: '‡∏™‡∏ô‡∏≤‡∏° 2 (‡∏õ.‡∏õ‡∏•‡∏≤‡∏¢)', duration: 60, type: 'group_9' },
        { id: 'FB_MH', sp:'FB', lv:'‡∏°‡∏±‡∏ò‡∏¢‡∏°', name: '‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏• ‡∏°‡∏±‡∏ò‡∏¢‡∏°', field: '‡∏™‡∏ô‡∏≤‡∏° 3 (‡∏°‡∏±‡∏ò‡∏¢‡∏°)', duration: 60, type: 'round_4' },
        // Volleyball
        { id: 'VB_PH', sp:'VB', lv:'‡∏õ.‡∏õ‡∏•‡∏≤‡∏¢', name: '‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå ‡∏õ.‡∏õ‡∏•‡∏≤‡∏¢', field: '‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå 1 (‡∏õ.‡∏õ‡∏•‡∏≤‡∏¢)', duration: 60, type: 'group_9' },
        { id: 'VB_MH', sp:'VB', lv:'‡∏°‡∏±‡∏ò‡∏¢‡∏°', name: '‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå ‡∏°‡∏±‡∏ò‡∏¢‡∏°', field: '‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå 2 (‡∏°‡∏±‡∏ò‡∏¢‡∏°)', duration: 60, type: 'round_4' },
        // Takraw (Shared)
        { id: 'TK_PH', sp:'TK', lv:'‡∏õ.‡∏õ‡∏•‡∏≤‡∏¢', name: '‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠ ‡∏õ.‡∏õ‡∏•‡∏≤‡∏¢', field: '‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠ (‡∏£‡∏ß‡∏°)', duration: 45, type: 'group_9' },
        { id: 'TK_MH', sp:'TK', lv:'‡∏°‡∏±‡∏ò‡∏¢‡∏°', name: '‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠ ‡∏°‡∏±‡∏ò‡∏¢‡∏°', field: '‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠ (‡∏£‡∏ß‡∏°)', duration: 45, type: 'round_4' },
        // Petanque
        { id: 'PT_PH', sp:'PT', lv:'‡∏õ.‡∏õ‡∏•‡∏≤‡∏¢', name: '‡πÄ‡∏õ‡∏ï‡∏≠‡∏á ‡∏õ.‡∏õ‡∏•‡∏≤‡∏¢', field: '‡πÄ‡∏õ‡∏ï‡∏≠‡∏á 1 (‡∏õ.‡∏õ‡∏•‡∏≤‡∏¢)', duration: 60, type: 'group_9' },
        { id: 'PT_MH', sp:'PT', lv:'‡∏°‡∏±‡∏ò‡∏¢‡∏°', name: '‡πÄ‡∏õ‡∏ï‡∏≠‡∏á ‡∏°‡∏±‡∏ò‡∏¢‡∏°', field: '‡πÄ‡∏õ‡∏ï‡∏≠‡∏á 2 (‡∏°‡∏±‡∏ò‡∏¢‡∏°)', duration: 60, type: 'round_4' }
    ];

    // Time Config (Minutes from 00:00)
    // Day 1-2: 13:00 (780) - 16:30 (990)
    // Day 3-4: 08:30 (510) - 16:30 (990)
    const daysConfig = [
        { day: 1, name: "day1", start: 780, end: 990 },
        { day: 2, name: "day2", start: 780, end: 990 },
        { day: 3, name: "day3", start: 510, end: 990 },
        { day: 4, name: "day4", start: 510, end: 990 }
    ];

    // --- 2. LOGIC ENGINE (Smart Scheduler) ---
    function generateSmartSchedule() {
        let allMatches = [];
        let generated = [];

        // 1. Generate Matches based on 9 Schools
        sportsConfig.forEach(sport => {
            if (sport.type === 'group_9') {
                // Shuffle Schools
                let shuffled = [...schools].sort(() => 0.5 - Math.random());
                let groups = [shuffled.slice(0,3), shuffled.slice(3,6), shuffled.slice(6,9)];
                let groupNames = ['A', 'B', 'C'];

                // Round Robin in Groups
                groups.forEach((g, idx) => {
                    for(let i=0; i<g.length; i++) {
                        for(let j=i+1; j<g.length; j++) {
                            allMatches.push({
                                sportConf: sport,
                                round: `‡∏£‡∏≠‡∏ö‡πÅ‡∏£‡∏Å ‡∏™‡∏≤‡∏¢ ${groupNames[idx]}`,
                                team1: g[i], team2: g[j],
                                priority: 1
                            });
                        }
                    }
                });
                // Finals (Simulation)
                allMatches.push({ sportConf: sport, round: "‡∏£‡∏≠‡∏ö‡∏£‡∏≠‡∏á‡∏Ø 1", team1: {name:"‡∏ó‡∏µ‡πà 1 ‡∏™‡∏≤‡∏¢ A", id:'W1'}, team2: {name:"‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏™‡∏∏‡∏î", id:'W4'}, priority: 2 });
                allMatches.push({ sportConf: sport, round: "‡∏£‡∏≠‡∏ö‡∏£‡∏≠‡∏á‡∏Ø 2", team1: {name:"‡∏ó‡∏µ‡πà 1 ‡∏™‡∏≤‡∏¢ B", id:'W2'}, team2: {name:"‡∏ó‡∏µ‡πà 1 ‡∏™‡∏≤‡∏¢ C", id:'W3'}, priority: 2 });
                allMatches.push({ sportConf: sport, round: "‡∏ä‡∏¥‡∏á‡∏ó‡∏µ‡πà 3", team1: {name:"‡πÅ‡∏û‡πâ‡∏£‡∏≠‡∏ö‡∏£‡∏≠‡∏á 1", id:'L1'}, team2: {name:"‡πÅ‡∏û‡πâ‡∏£‡∏≠‡∏ö‡∏£‡∏≠‡∏á 2", id:'L2'}, priority: 3 });
                allMatches.push({ sportConf: sport, round: "‡∏ä‡∏¥‡∏á‡∏ä‡∏ô‡∏∞‡πÄ‡∏•‡∏¥‡∏®", team1: {name:"‡∏ä‡∏ô‡∏∞‡∏£‡∏≠‡∏ö‡∏£‡∏≠‡∏á 1", id:'WF1'}, team2: {name:"‡∏ä‡∏ô‡∏∞‡∏£‡∏≠‡∏ö‡∏£‡∏≠‡∏á 2", id:'WF2'}, priority: 3 });

            } else {
                // Secondary 4 Teams (Randomly pick 4 for logic)
                let mTeams = schools.slice(0, 4);
                for(let i=0; i<mTeams.length; i++) {
                    for(let j=i+1; j<mTeams.length; j++) {
                        allMatches.push({
                            sportConf: sport,
                            round: `‡∏û‡∏ö‡∏Å‡∏±‡∏ô‡∏´‡∏°‡∏î`,
                            team1: mTeams[i], team2: mTeams[j],
                            priority: 1
                        });
                    }
                }
                allMatches.push({ sportConf: sport, round: "‡∏ä‡∏¥‡∏á‡∏ä‡∏ô‡∏∞‡πÄ‡∏•‡∏¥‡∏®", team1: {name:"‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö 1", id:'M1'}, team2: {name:"‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö 2", id:'M2'}, priority: 2 });
            }
        });
        allMatches.sort((a,b) => a.priority - b.priority);

        // 2. Schedule Logic (Conflict & Gap)
        let fieldNextFree = {}; 
        let schoolNextFree = {};

        // Init trackers
        sportsConfig.forEach(s => { daysConfig.forEach(d => fieldNextFree[`${s.field}_D${d.day}`] = d.start); });
        schools.forEach(s => { daysConfig.forEach(d => schoolNextFree[`${s.id}_D${d.day}`] = d.start); });

        let queue = [...allMatches];

        for (let d = 0; d < daysConfig.length; d++) {
            let dayConf = daysConfig[d];
            let nextDayQueue = [];

            // Reset field availability to start of day
            sportsConfig.forEach(s => {
               let key = `${s.field}_D${dayConf.day}`;
               if(fieldNextFree[key] < dayConf.start) fieldNextFree[key] = dayConf.start;
            });

            for (let i = 0; i < queue.length; i++) {
                let m = queue[i];
                let fKey = `${m.sportConf.field}_D${dayConf.day}`;
                let fieldTime = fieldNextFree[fKey];

                // Check Field Time limit
                if (fieldTime + m.sportConf.duration > dayConf.end) { nextDayQueue.push(m); continue; }

                // Check Team Availability (Conflict & Gap)
                let t1Ready = dayConf.start;
                let t2Ready = dayConf.start;
                if (m.team1.id) t1Ready = schoolNextFree[`${m.team1.id}_D${dayConf.day}`] || dayConf.start;
                if (m.team2.id) t2Ready = schoolNextFree[`${m.team2.id}_D${dayConf.day}`] || dayConf.start;

                // Start Time is MAX of Field availability and Both Teams readiness
                let startTime = Math.max(fieldTime, t1Ready, t2Ready);
                let endTime = startTime + m.sportConf.duration;

                // Check if match finishes before end of day
                if (endTime > dayConf.end) { nextDayQueue.push(m); continue; }

                // Schedule IT!
                generated.push({
                    id: `${m.sportConf.id}_${generated.length}`,
                    d: `day${dayConf.day}`,
                    t: formatTime(startTime),
                    f: m.sportConf.field,
                    sp: m.sportConf.sp,
                    lv: m.sportConf.lv,
                    t1: m.team1.name,
                    t2: m.team2.name,
                    s1: "", s2: "",
                    cat: m.round,
                    desc: `${m.sportConf.name} ${m.round}`
                });

                // Update Trackers
                fieldNextFree[fKey] = endTime;
                // Add Gap (Rest/Ref) equal to match duration
                let gap = m.sportConf.duration; 
                if (m.team1.id) schoolNextFree[`${m.team1.id}_D${dayConf.day}`] = endTime + gap;
                if (m.team2.id) schoolNextFree[`${m.team2.id}_D${dayConf.day}`] = endTime + gap;
            }
            queue = nextDayQueue;
        }

        // Add Fixed Events
        generated.push({ id:"EV1", d:"day2", t:"08.00", f:"‡∏™‡∏ô‡∏≤‡∏°‡∏Å‡∏•‡∏≤‡∏á", sp:"EV", lv:"ALL", desc:"üè≥Ô∏è‚Äçüåà ‡∏Ç‡∏ö‡∏ß‡∏ô‡∏û‡∏≤‡πÄ‡∏´‡∏£‡∏î", t1:"-", t2:"-" });
        generated.push({ id:"EV2", d:"day2", t:"09.00", f:"‡∏™‡∏ô‡∏≤‡∏°‡∏Å‡∏•‡∏≤‡∏á", sp:"EV", lv:"ALL", desc:"üéà ‡∏û‡∏¥‡∏ò‡∏µ‡πÄ‡∏õ‡∏¥‡∏î", t1:"-", t2:"-" });
        generated.push({ id:"AT1", d:"day3", t:"09.00", f:"‡∏•‡∏π‡πà‡∏ß‡∏¥‡πà‡∏á", sp:"AT", lv:"ALL", desc:"üèÉ ‡∏ß‡∏¥‡πà‡∏á 100‡∏°.", t1:"-", t2:"-" });

        return generated;
    }

    function formatTime(mins) {
        let h = Math.floor(mins / 60);
        let m = mins % 60;
        return `${h.toString().padStart(2,'0')}.${m.toString().padStart(2,'0')}`;
    }

    // --- 3. INIT & EVENT LISTENERS ---
    document.addEventListener('DOMContentLoaded', () => {
        let d = localStorage.getItem('ns_smart_v1');
        if(d) matches = JSON.parse(d);
        else { matches = generateSmartSchedule(); saveData(false); }
        render();
    });

    // --- 4. RENDER UI ---
    function render() {
        const area = document.getElementById('content-area');
        area.innerHTML = '';

        if(currentMode === 'welcome') {
            area.innerHTML = `
            <div class="welcome-box">
                <i class="fas fa-medal welcome-icon"></i>
                <div class="welcome-title">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</div>
                <div class="welcome-text">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (Smart Schedule)<br>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ô‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏£‡∏¥‡∏á<br>‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ß‡πâ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏û‡∏±‡∏Å‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤/‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£</div>
                <div class="welcome-grid">
                    <div class="w-btn" onclick="filterSport('FB')"><i class="fas fa-futbol" style="color:var(--c-fb)"></i><span>‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏•</span></div>
                    <div class="w-btn" onclick="filterSport('VB')"><i class="fas fa-volleyball-ball" style="color:var(--c-vb)"></i><span>‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå</span></div>
                    <div class="w-btn" onclick="filterSport('TK')"><i class="fas fa-baseball-ball" style="color:var(--c-tk)"></i><span>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠</span></div>
                    <div class="w-btn" onclick="filterSport('PT')"><i class="fas fa-bowling-ball" style="color:var(--c-pt)"></i><span>‡πÄ‡∏õ‡∏ï‡∏≠‡∏á</span></div>
                    <div class="w-btn" onclick="filterSport('AT')"><i class="fas fa-running" style="color:var(--c-at)"></i><span>‡∏Å‡∏£‡∏µ‡∏ë‡∏≤</span></div>
                </div>
            </div>`;
            return;
        }

        let list = matches.filter(m => m.d === currentDay);
        if(currentSport !== 'ALL') list = list.filter(m => {
            if(currentSport==='AT') return m.sp==='AT' || m.sp==='EV';
            return m.sp === currentSport;
        });
        list.sort((a,b) => a.t.localeCompare(b.t));

        if(list.length === 0) {
            area.innerHTML = `<div style="text-align:center; padding:50px; color:#cbd5e1;"><i class="far fa-calendar-times" style="font-size:3rem;"></i><br>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ</div>`;
            return;
        }

        let grid = document.createElement('div');
        grid.className = 'schedule-grid';

        let times = [...new Set(list.map(m => m.t))];
        times.forEach(t => {
            let tBlock = document.createElement('div');
            tBlock.className = 'time-block';
            let rowsHtml = list.filter(m => m.t === t).map(m => {
                if(m.sp === 'AT' || m.sp === 'EV') return `<div class="match-row b-${m.sp}"><b>${m.desc}</b> (${m.f})</div>`;
                
                let s1 = parseInt(m.s1), s2 = parseInt(m.s2);
                let w1 = (s1>s2)?'color:#10b981':'', w2 = (s2>s1)?'color:#10b981':'';
                let spColor = `var(--c-${m.sp.toLowerCase()})`;
                
                return `
                <div class="match-row b-${m.sp}">
                    <div class="m-info">
                        <div class="m-cat"><span style="background:${spColor};color:white;">${m.sp}</span> <span>${m.lv}</span> <span>${m.cat}</span></div>
                        <div class="m-vs">
                            <span style="${w1}">${m.t1}</span>
                            <div class="score-box">
                                <input type="number" value="${m.s1}" onchange="upd('${m.id}',1,this.value)">:
                                <input type="number" value="${m.s2}" onchange="upd('${m.id}',2,this.value)">
                            </div>
                            <span style="${w2}">${m.t2}</span>
                        </div>
                        <div style="font-size:0.75rem; color:#94a3b8;">${m.f}</div>
                    </div>
                </div>`;
            }).join('');
            
            tBlock.innerHTML = `<div class="time-header"><i class="far fa-clock"></i> ${t} ‡∏ô.</div>${rowsHtml}`;
            grid.appendChild(tBlock);
        });
        area.appendChild(grid);
        renderStandings();
    }

    function renderStandings() {
        const container = document.getElementById('standings-area');
        container.innerHTML = '';
        if(currentMode === 'welcome' || currentSport === 'AT') { container.innerHTML = `<div class="empty-state">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>`; return; }

        // Group matches by category (Level)
        let sportMatches = matches.filter(m => m.sp === currentSport);
        let levels = [...new Set(sportMatches.map(m => m.lv))];

        levels.forEach(lv => {
            let lvMatches = sportMatches.filter(m => m.lv === lv);
            let stats = {};
            
            // Collect Teams
            lvMatches.forEach(m => {
                if(m.t1 !== '-' && !m.t1.includes('(')) stats[m.t1] = {P:0,W:0,D:0,L:0,PTS:0};
                if(m.t2 !== '-' && !m.t2.includes('(')) stats[m.t2] = {P:0,W:0,D:0,L:0,PTS:0};
            });

            // Calc Stats
            lvMatches.forEach(m => {
                if(m.s1!=="" && m.s2!=="" && stats[m.t1] && stats[m.t2]) {
                    let s1=parseInt(m.s1), s2=parseInt(m.s2);
                    stats[m.t1].P++; stats[m.t2].P++;
                    if(s1>s2) { stats[m.t1].W++; stats[m.t1].PTS+=3; stats[m.t2].L++; }
                    else if(s2>s1) { stats[m.t2].W++; stats[m.t2].PTS+=3; stats[m.t1].L++; }
                    else { stats[m.t1].D++; stats[m.t1].PTS+=1; stats[m.t2].D++; stats[m.t2].PTS+=1; }
                }
            });

            let sorted = Object.keys(stats).sort((a,b) => stats[b].PTS - stats[a].PTS);
            if(sorted.length === 0) return;

            let box = document.createElement('div');
            box.className = 'st-box';
            let rows = sorted.map((t,i) => {
                let s = stats[t];
                return `<tr><td>${i+1}</td><td>${t}</td><td>${s.P}</td><td>${s.W}</td><td>${s.D}</td><td>${s.L}</td><td class="st-pts">${s.PTS}</td></tr>`;
            }).join('');
            
            box.innerHTML = `<div class="st-head">${lv}</div><table class="st-table"><tr><th>#</th><th>‡∏ó‡∏µ‡∏°</th><th>P</th><th>W</th><th>D</th><th>L</th><th>Pts</th></tr>${rows}</table>`;
            let wrap = document.createElement('div'); wrap.style.marginBottom="15px"; wrap.appendChild(box);
            container.appendChild(wrap);
        });
    }

    function switchDay(d) { currentDay=d; document.querySelectorAll('.day-btn').forEach(b=>b.classList.remove('active')); event.target.classList.add('active'); if(currentMode==='schedule') render(); }
    function filterSport(sp) { currentSport=sp; currentMode='schedule'; document.querySelectorAll('.nav-item').forEach(b=>b.classList.remove('active')); event.currentTarget.classList.add('active'); render(); }
    function goHome() { currentMode='welcome'; currentSport='ALL'; document.querySelectorAll('.nav-item').forEach(b=>b.classList.remove('active')); render(); }
    function upd(id, slot, val) { let m = matches.find(x=>x.id===id); if(m){ if(slot==1)m.s1=val; else m.s2=val; saveData(true); renderStandings(); } }
    function saveData(toast) { localStorage.setItem('ns_smart_v1', JSON.stringify(matches)); if(toast) showToast(); }
    function saveDataManual() { saveData(true); }
    function showToast() { let t=document.getElementById('toast'); t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),2000); }
    function resetData() { if(confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡πà‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) { matches = generateSmartSchedule(); saveData(false); location.reload(); } }
</script>
</body>
</html>
