<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard ‡πÇ‡∏ô‡∏ô‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå ‡πÄ‡∏Å‡∏°‡∏™‡πå 2568 (V.32 Complete)</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
    :root { 
        --header-h: 60px;
        --sidebar-w: 220px;
        --primary: #2563eb; --bg: #f1f5f9; --text: #1e293b; --white: #ffffff;
        --border: #e2e8f0; --accent: #f59e0b;
        /* Sport Colors */
        --c-fb: #3b82f6; --c-vb: #f97316; --c-tk: #10b981; --c-pt: #8b5cf6; --c-at: #ef4444;
    }
    * { box-sizing: border-box; }
    body { font-family: 'Sarabun', sans-serif; background: var(--bg); margin: 0; padding: 0; color: var(--text); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
    
    /* --- HEADER --- */
    .app-header {
        height: var(--header-h); background: var(--white); border-bottom: 1px solid var(--border);
        display: flex; align-items: center; justify-content: space-between; padding: 0 20px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05); z-index: 10;
    }
    .app-title { font-size: 1.2rem; font-weight: bold; color: var(--primary); display: flex; align-items: center; gap: 10px; }
    
    .day-tabs { display: flex; gap: 5px; background: var(--bg); padding: 4px; border-radius: 8px; }
    .day-btn {
        border: none; background: transparent; padding: 6px 12px; border-radius: 6px;
        font-size: 0.9rem; cursor: pointer; color: #64748b; font-weight: 600; transition: 0.2s;
    }
    .day-btn:hover { background: #e2e8f0; }
    .day-btn.active { background: var(--white); color: var(--primary); box-shadow: 0 1px 2px rgba(0,0,0,0.1); }

    .actions { display: flex; gap: 10px; }
    .btn-icon { width: 36px; height: 36px; border-radius: 6px; border: 1px solid var(--border); background: var(--white); cursor: pointer; color: #64748b; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
    .btn-icon:hover { background: #f8fafc; color: var(--primary); }
    .btn-save { color: #10b981; border-color: #bbf7d0; background: #f0fdf4; }
    .btn-reset { color: #ef4444; border-color: #fecaca; background: #fef2f2; }

    /* --- MAIN LAYOUT --- */
    .main-container { flex: 1; display: flex; overflow: hidden; }

    /* SIDEBAR (Sport Filter) */
    .sidebar { width: var(--sidebar-w); background: var(--white); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 15px; overflow-y: auto; }
    .menu-title { font-size: 0.75rem; text-transform: uppercase; color: #94a3b8; font-weight: bold; margin-bottom: 10px; letter-spacing: 0.5px; }
    .nav-item {
        display: flex; align-items: center; gap: 10px; padding: 10px 12px; margin-bottom: 5px;
        border-radius: 8px; cursor: pointer; font-weight: 500; color: #475569; transition: 0.2s;
    }
    .nav-item:hover { background: #f1f5f9; color: var(--primary); }
    .nav-item.active { background: #eff6ff; color: var(--primary); }
    .nav-icon { width: 24px; text-align: center; }

    /* CENTER (Schedule) */
    .content-area { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 20px; scroll-behavior: smooth; }
    
    .match-table-container { background: var(--white); border-radius: 10px; border: 1px solid var(--border); overflow: hidden; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
    .match-header { background:#f8fafc; padding:8px 15px; border-bottom:1px solid var(--border); font-weight:bold; color:#64748b; font-size:0.9rem; display: flex; align-items: center; gap: 8px; }
    
    .match-row {
        display: grid; grid-template-columns: 70px 150px 1fr 100px 100px;
        align-items: center; padding: 10px 15px; border-bottom: 1px solid var(--border);
        font-size: 0.95rem; transition: 0.1s;
    }
    .match-row:last-child { border-bottom: none; }
    .match-row:hover { background: #f8fafc; }
    
    .m-time { font-weight: bold; color: var(--primary); font-family: 'Courier New', monospace; }
    .m-cat { display: flex; flex-direction: column; font-size: 0.85rem; line-height: 1.2; }
    .cat-name { font-weight: 600; }
    .cat-sub { color: #94a3b8; font-size: 0.75rem; }
    
    .m-vs { display: flex; align-items: center; gap: 10px; justify-content: center; }
    .t-name { flex: 1; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 0.95rem; }
    .t-right { text-align: right; } .t-left { text-align: left; }
    
    .score-inputs { display: flex; align-items: center; gap: 5px; background: #f1f5f9; padding: 2px 6px; border-radius: 6px; }
    .score-inp { width: 30px; border: none; background: transparent; text-align: center; font-weight: bold; font-size: 1.1rem; color: var(--primary); padding: 0; }
    .score-inp:focus { outline: none; background: #e2e8f0; }

    .m-field { font-size: 0.8rem; color: #64748b; text-align: center; background: #f1f5f9; padding: 2px 8px; border-radius: 4px; display: inline-block; white-space: nowrap; }
    .m-status { text-align: right; color: #cbd5e1; font-size: 1.2rem; }
    .m-status.done { color: #10b981; }

    /* RIGHT (Standings) */
    .right-panel { width: 340px; background: var(--white); border-left: 1px solid var(--border); display: flex; flex-direction: column; overflow-y: auto; }
    .panel-header { padding: 15px; border-bottom: 1px solid var(--border); font-weight: bold; color: var(--text); background: #f8fafc; }
    .standings-list { padding: 15px; display: flex; flex-direction: column; gap: 20px; }
    
    .st-box { border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
    .st-head { background: #f1f5f9; padding: 8px 12px; font-size: 0.85rem; font-weight: bold; color: #475569; border-bottom: 1px solid var(--border); }
    .st-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
    .st-table td, .st-table th { padding: 6px 8px; text-align: center; border-bottom: 1px solid #f1f5f9; }
    .st-table th { color: #94a3b8; font-weight: 500; font-size: 0.8rem; }
    .st-table td:nth-child(2) { text-align: left; font-weight: 600; color: var(--text); width: 50%; }
    .st-pts { background: #eff6ff; color: var(--primary); font-weight: bold; }

    /* Empty State */
    .empty-state { text-align: center; padding: 40px; color: #94a3b8; }
    
    #toast { visibility: hidden; min-width: 200px; background-color: #333; color: #fff; text-align: center; border-radius: 4px; padding: 12px; position: fixed; z-index: 9999; left: 50%; bottom: 30px; transform: translateX(-50%); font-size: 0.9rem; }
    #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }

    @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
    @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }

    @media (max-width: 1024px) {
        .right-panel { display: none; }
        .match-row { grid-template-columns: 60px 1fr 80px; gap: 5px; }
        .m-cat, .m-field { display: none; }
    }
</style>
</head>
<body>

<header class="app-header">
    <div class="app-title"><i class="fas fa-trophy"></i> ‡πÇ‡∏ô‡∏ô‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå ‡πÄ‡∏Å‡∏°‡∏™‡πå</div>
    <div class="day-tabs">
        <button class="day-btn active" onclick="switchDay('day1')">16 ‡∏ò.‡∏Ñ.</button>
        <button class="day-btn" onclick="switchDay('day2')">17 ‡∏ò.‡∏Ñ.</button>
        <button class="day-btn" onclick="switchDay('day3')">18 ‡∏ò.‡∏Ñ.</button>
        <button class="day-btn" onclick="switchDay('day4')">19 ‡∏ò.‡∏Ñ.</button>
    </div>
    <div class="actions">
        <button class="btn-icon btn-save" title="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å" onclick="saveDataManual()"><i class="fas fa-save"></i></button>
        <button class="btn-icon btn-reset" title="‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" onclick="resetData()"><i class="fas fa-redo-alt"></i></button>
    </div>
</header>

<div class="main-container">
    <aside class="sidebar">
        <div class="menu-title">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤</div>
        <div class="nav-item active" onclick="filterSport('ALL')"><span class="nav-icon"><i class="fas fa-layer-group"></i></span> ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
        <div class="nav-item" onclick="filterSport('FB')"><span class="nav-icon" style="color:var(--c-fb)"><i class="fas fa-futbol"></i></span> ‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏•</div>
        <div class="nav-item" onclick="filterSport('VB')"><span class="nav-icon" style="color:var(--c-vb)"><i class="fas fa-volleyball-ball"></i></span> ‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå</div>
        <div class="nav-item" onclick="filterSport('TK')"><span class="nav-icon" style="color:var(--c-tk)"><i class="fas fa-baseball-ball"></i></span> ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠</div>
        <div class="nav-item" onclick="filterSport('PT')"><span class="nav-icon" style="color:var(--c-pt)"><i class="fas fa-bowling-ball"></i></span> ‡πÄ‡∏õ‡∏ï‡∏≠‡∏á</div>
        <div class="nav-item" onclick="filterSport('AT')"><span class="nav-icon" style="color:var(--c-at)"><i class="fas fa-running"></i></span> ‡∏Å‡∏£‡∏µ‡∏ë‡∏≤</div>
    </aside>

    <main class="content-area" id="schedule-area"></main>

    <aside class="right-panel">
        <div class="panel-header"><i class="fas fa-chart-bar"></i> ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
        <div class="standings-list" id="standings-area"></div>
    </aside>
</div>

<div id="toast">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ</div>

<script>
    // --- 1. CONFIGURATION ---
    const secTeams = ["‡∏´‡∏ô‡∏≠‡∏á‡∏Å‡∏∏‡∏á‡∏®‡∏£‡∏µ‡∏Ø", "‡∏†‡∏π‡∏û‡∏£‡∏∞‡∏Ø", "‡πÇ‡∏ô‡∏ô‡∏°‡πà‡∏ß‡∏á", "‡πÇ‡∏ô‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á"];
    const priTeams = { 
        A: ["‡πÇ‡∏ô‡∏ô‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå‡∏Ø", "‡∏ó‡πà‡∏≤‡∏≠‡∏∏‡∏ó‡∏±‡∏¢", "‡∏†‡∏π‡∏û‡∏£‡∏∞‡∏Ø"],
        B: ["‡πÇ‡∏ô‡∏ô‡∏™‡∏ß‡∏≤‡∏ó‡∏Ø", "‡∏´‡∏ô‡∏≠‡∏á‡∏Å‡∏∏‡∏á‡∏®‡∏£‡∏µ‡∏Ø", "‡πÇ‡∏ô‡∏ô‡πÑ‡∏´‡∏°‡∏Ø"],
        C: ["‡∏î‡πâ‡∏ß‡∏á‡∏Ø-‡∏ä‡∏≥‡∏Ø", "‡πÇ‡∏ô‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á", "‡πÇ‡∏ô‡∏ô‡∏°‡πà‡∏ß‡∏á"]
    };
    
    // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á 20 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
    const categories = [
        { code: "FB_ANU_M", sp: "FB", lv: "ANU", gd: "M", name: "‡∏ö‡∏≠‡∏•‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• ‡∏ä‡∏≤‡∏¢" },
        { code: "FB_ANU_F", sp: "FB", lv: "ANU", gd: "F", name: "‡∏ö‡∏≠‡∏•‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• ‡∏´‡∏ç‡∏¥‡∏á" },
        { code: "FB_P13_M", sp: "FB", lv: "P13", gd: "M", name: "‡∏ö‡∏≠‡∏• ‡∏õ.1-3 ‡∏ä‡∏≤‡∏¢" },
        { code: "FB_P13_F", sp: "FB", lv: "P13", gd: "F", name: "‡∏ö‡∏≠‡∏• ‡∏õ.1-3 ‡∏´‡∏ç‡∏¥‡∏á" },
        { code: "FB_P46_M", sp: "FB", lv: "P46", gd: "M", name: "‡∏ö‡∏≠‡∏• ‡∏õ.4-6 ‡∏ä‡∏≤‡∏¢" },
        { code: "FB_P46_F", sp: "FB", lv: "P46", gd: "F", name: "‡∏ö‡∏≠‡∏• ‡∏õ.4-6 ‡∏´‡∏ç‡∏¥‡∏á" },
        { code: "FB_SEC_M", sp: "FB", lv: "SEC", gd: "M", name: "‡∏ö‡∏≠‡∏•‡∏°‡∏±‡∏ò‡∏¢‡∏° ‡∏ä‡∏≤‡∏¢" },
        { code: "FB_SEC_F", sp: "FB", lv: "SEC", gd: "F", name: "‡∏ö‡∏≠‡∏•‡∏°‡∏±‡∏ò‡∏¢‡∏° ‡∏´‡∏ç‡∏¥‡∏á" },
        { code: "VB_P46_M", sp: "VB", lv: "P46", gd: "M", name: "‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå ‡∏õ.4-6 ‡∏ä‡∏≤‡∏¢" },
        { code: "VB_P46_F", sp: "VB", lv: "P46", gd: "F", name: "‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå ‡∏õ.4-6 ‡∏´‡∏ç‡∏¥‡∏á" },
        { code: "VB_SEC_M", sp: "VB", lv: "SEC", gd: "M", name: "‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå ‡∏°‡∏±‡∏ò‡∏¢‡∏° ‡∏ä‡∏≤‡∏¢" },
        { code: "VB_SEC_F", sp: "VB", lv: "SEC", gd: "F", name: "‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå ‡∏°‡∏±‡∏ò‡∏¢‡∏° ‡∏´‡∏ç‡∏¥‡∏á" },
        { code: "TK_P46_M", sp: "TK", lv: "P46", gd: "M", name: "‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠ ‡∏õ.4-6 ‡∏ä‡∏≤‡∏¢" },
        { code: "TK_P46_F", sp: "TK", lv: "P46", gd: "F", name: "‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠ ‡∏õ.4-6 ‡∏´‡∏ç‡∏¥‡∏á" },
        { code: "TK_SEC_M", sp: "TK", lv: "SEC", gd: "M", name: "‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠ ‡∏°‡∏±‡∏ò‡∏¢‡∏° ‡∏ä‡∏≤‡∏¢" },
        { code: "TK_SEC_F", sp: "TK", lv: "SEC", gd: "F", name: "‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠ ‡∏°‡∏±‡∏ò‡∏¢‡∏° ‡∏´‡∏ç‡∏¥‡∏á" },
        { code: "PT_P46_M", sp: "PT", lv: "P46", gd: "M", name: "‡πÄ‡∏õ‡∏ï‡∏≠‡∏á ‡∏õ.4-6 ‡∏ä‡∏≤‡∏¢" },
        { code: "PT_P46_F", sp: "PT", lv: "P46", gd: "F", name: "‡πÄ‡∏õ‡∏ï‡∏≠‡∏á ‡∏õ.4-6 ‡∏´‡∏ç‡∏¥‡∏á" },
        { code: "PT_SEC_M", sp: "PT", lv: "SEC", gd: "M", name: "‡πÄ‡∏õ‡∏ï‡∏≠‡∏á ‡∏°‡∏±‡∏ò‡∏¢‡∏° ‡∏ä‡∏≤‡∏¢" },
        { code: "PT_SEC_F", sp: "PT", lv: "SEC", gd: "F", name: "‡πÄ‡∏õ‡∏ï‡∏≠‡∏á ‡∏°‡∏±‡∏ò‡∏¢‡∏° ‡∏´‡∏ç‡∏¥‡∏á" }
    ];

    let matches = [];
    let currentDay = 'day1';
    let currentSport = 'ALL';

    // --- 2. GENERATOR (‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏Ç‡πà‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥) ---
    function generateSchedule() {
        let generated = [];
        
        // 2.1 Fixed Events
        generated.push(
            { id:"AT1", d:"day1", t:"08.30", f:"‡∏•‡∏π‡πà‡∏ß‡∏¥‡πà‡∏á", sp:"AT", lv:"ALL", desc:"üèÉ ‡∏ß‡∏¥‡πà‡∏á 80‡∏°. (‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•/‡∏õ.‡∏ï‡πâ‡∏ô)", t1:"-", t2:"-" },
            { id:"AT2", d:"day1", t:"09.30", f:"‡∏•‡∏π‡πà‡∏ß‡∏¥‡πà‡∏á", sp:"AT", lv:"ALL", desc:"üèÉ ‡∏ß‡∏¥‡πà‡∏á 100‡∏°. (‡∏õ.‡∏õ‡∏•‡∏≤‡∏¢/‡∏°‡∏±‡∏ò‡∏¢‡∏°)", t1:"-", t2:"-" },
            { id:"AT3", d:"day1", t:"10.30", f:"‡∏•‡∏π‡πà‡∏ß‡∏¥‡πà‡∏á", sp:"AT", lv:"ALL", desc:"üèÉ ‡∏ß‡∏¥‡πà‡∏á‡∏ú‡∏•‡∏±‡∏î 4x80‡∏°.", t1:"-", t2:"-" },
            { id:"AT4", d:"day1", t:"11.30", f:"‡∏•‡∏π‡πà‡∏ß‡∏¥‡πà‡∏á", sp:"AT", lv:"ALL", desc:"üèÉ ‡∏ß‡∏¥‡πà‡∏á‡∏ú‡∏•‡∏±‡∏î 4x100‡∏°.", t1:"-", t2:"-" },
            { id:"EV1", d:"day2", t:"08.00", f:"‡∏™‡∏ô‡∏≤‡∏°‡∏Å‡∏•‡∏≤‡∏á", sp:"EV", lv:"ALL", desc:"üè≥Ô∏è‚Äçüåà ‡∏Ç‡∏ö‡∏ß‡∏ô‡∏û‡∏≤‡πÄ‡∏´‡∏£‡∏î", t1:"-", t2:"-" },
            { id:"EV2", d:"day2", t:"09.00", f:"‡∏™‡∏ô‡∏≤‡∏°‡∏Å‡∏•‡∏≤‡∏á", sp:"EV", lv:"ALL", desc:"üéà ‡∏û‡∏¥‡∏ò‡∏µ‡πÄ‡∏õ‡∏¥‡∏î", t1:"-", t2:"-" }
        );

        // 2.2 Field Queues
        let queues = {
            FB1: { d:1, h:13, m:0 }, FB2: { d:1, h:13, m:0 }, FB3: { d:1, h:13, m:0 }, // ‡∏ö‡∏≠‡∏• 1 ‡∏ä‡∏°.
            FBA: { d:1, h:13, m:0 }, // ‡∏ö‡∏≠‡∏•‡πÄ‡∏î‡πá‡∏Å 30 ‡∏ô‡∏≤‡∏ó‡∏µ
            VB1: { d:1, h:13, m:0 }, VB2: { d:1, h:13, m:0 }, // ‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå 45 ‡∏ô‡∏≤‡∏ó‡∏µ
            TK1: { d:1, h:13, m:0 }, // ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠ 40 ‡∏ô‡∏≤‡∏ó‡∏µ
            PT1: { d:1, h:13, m:0 }, PT2: { d:1, h:13, m:0 } // ‡πÄ‡∏õ‡∏ï‡∏≠‡∏á 45 ‡∏ô‡∏≤‡∏ó‡∏µ
        };

        const advanceTime = (q, dur) => {
            q.m += dur; while(q.m>=60){ q.m-=60; q.h++; }
            if(q.d===1 && q.h>=17) { q.d=2; q.h=13; q.m=0; }
            if(q.d===2 && q.h>=17) { q.d=3; q.h=8; q.m=30; }
        };
        const compareTime = (a, b) => (a.d*10000 + a.h*100 + a.m) - (b.d*10000 + b.h*100 + b.m);
        const formatTime = (t) => `${t.h.toString().padStart(2,'0')}.${t.m.toString().padStart(2,'0')}`;

        const getField = (sp, lv) => {
            if(sp==='FB') {
                if(lv==='ANU') return {q: queues.FBA, name:'‡∏™‡∏ô‡∏≤‡∏°‡πÄ‡∏î‡πá‡∏Å', dur:30};
                let q1=queues.FB1, q2=queues.FB2, q3=queues.FB3;
                if(compareTime(q1,q2)<=0 && compareTime(q1,q3)<=0) return {q:q1, name:'‡∏™‡∏ô‡∏≤‡∏° 1', dur:60};
                if(compareTime(q2,q3)<=0) return {q:q2, name:'‡∏™‡∏ô‡∏≤‡∏° 2', dur:60};
                return {q:q3, name:'‡∏™‡∏ô‡∏≤‡∏° 3', dur:60};
            }
            if(sp==='VB') return (compareTime(queues.VB1,queues.VB2)<=0) ? {q:queues.VB1, name:'‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå 1', dur:45} : {q:queues.VB2, name:'‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå 2', dur:45};
            if(sp==='TK') return {q:queues.TK1, name:'‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠ 1', dur:40};
            if(sp==='PT') return (compareTime(queues.PT1,queues.PT2)<=0) ? {q:queues.PT1, name:'‡πÄ‡∏õ‡∏ï‡∏≠‡∏á 1', dur:45} : {q:queues.PT2, name:'‡πÄ‡∏õ‡∏ï‡∏≠‡∏á 2', dur:45};
            return null;
        };

        // 2.3 Generate Matches
        let allPairings = [];
        categories.forEach(cat => {
            let pairings = [];
            if(cat.lv === 'SEC') { // ‡∏•‡∏µ‡∏Å 4 ‡∏ó‡∏µ‡∏° (‡∏û‡∏ö‡∏Å‡∏±‡∏ô‡∏´‡∏°‡∏î 1 ‡∏£‡∏≠‡∏ö = 6 ‡∏ô‡∏±‡∏î)
                let t = secTeams;
                pairings.push({t1:t[0], t2:t[1], st:'‡∏•‡∏µ‡∏Å'}, {t1:t[2], t2:t[3], st:'‡∏•‡∏µ‡∏Å'});
                pairings.push({t1:t[0], t2:t[2], st:'‡∏•‡∏µ‡∏Å'}, {t1:t[1], t2:t[3], st:'‡∏•‡∏µ‡∏Å'});
                pairings.push({t1:t[0], t2:t[3], st:'‡∏•‡∏µ‡∏Å'}, {t1:t[1], t2:t[2], st:'‡∏•‡∏µ‡∏Å'});
            } else { // ‡πÅ‡∏ö‡πà‡∏á‡∏™‡∏≤‡∏¢ (9 ‡∏ó‡∏µ‡∏°)
                ['A','B','C'].forEach(g => {
                    let t = (cat.lv==='ANU')? ["‡πÇ‡∏ô‡∏ô‡∏°‡πà‡∏ß‡∏á","‡∏ó‡πà‡∏≤‡∏≠‡∏∏‡∏ó‡∏±‡∏¢","‡∏†‡∏π‡∏û‡∏£‡∏∞‡∏Ø"] : priTeams[g]; // Simplify Anu for demo
                    if(cat.lv!=='ANU') t = priTeams[g]; // Use correct teams
                    pairings.push({t1:t[0], t2:t[1], st:`‡∏™‡∏≤‡∏¢ ${g}`}, {t1:t[1], t2:t[2], st:`‡∏™‡∏≤‡∏¢ ${g}`}, {t1:t[2], t2:t[0], st:`‡∏™‡∏≤‡∏¢ ${g}`});
                });
            }
            pairings.forEach((p,i) => allPairings.push({...p, cat:cat, idx:i}));
        });

        // Interleave to mix sports
        allPairings.sort((a,b) => a.idx - b.idx);

        allPairings.forEach(p => {
            let slot = getField(p.cat.sp, p.cat.lv);
            if(slot) {
                generated.push({
                    id: `${p.cat.code}_${p.idx}`, d: `day${slot.q.d}`, t: formatTime(slot.q), f: slot.name,
                    sp: p.cat.sp, lv: p.cat.lv, gd: p.cat.gd, t1: p.t1, t2: p.t2, s1:"", s2:"", cat: p.st,
                    desc: `${p.cat.n} ${p.st}`
                });
                advanceTime(slot.q, slot.dur);
            }
        });

        // Finals
        categories.forEach(cat => {
            generated.push({
                id: `FIN_${cat.code}`, d: 'day4', t: '09.00', f: '‡∏™‡∏ô‡∏≤‡∏°‡∏Å‡∏•‡∏≤‡∏á',
                sp: cat.sp, lv: cat.lv, gd: cat.gd, cat: '‡∏ä‡∏¥‡∏á‡∏ä‡∏ô‡∏∞‡πÄ‡∏•‡∏¥‡∏®', t1:'(‡∏£‡∏≠‡∏ä‡∏¥‡∏á)', t2:'(‡∏£‡∏≠‡∏ä‡∏¥‡∏á)', s1:'', s2:'', desc: `${cat.name} ‡∏ä‡∏¥‡∏á‡∏ä‡∏ô‡∏∞‡πÄ‡∏•‡∏¥‡∏®`
            });
        });

        return generated;
    }

    // --- 3. INIT ---
    document.addEventListener('DOMContentLoaded', () => {
        let d = localStorage.getItem('ns_v32_db');
        if(d) matches = JSON.parse(d);
        else { matches = generateSchedule(); saveData(); }
        render();
    });

    // --- 4. RENDER UI ---
    function render() {
        renderSchedule();
        renderStandings();
    }

    function renderSchedule() {
        const container = document.getElementById('schedule-area');
        container.innerHTML = '';
        
        let list = matches.filter(m => m.d === currentDay);
        if(currentSport !== 'ALL') list = list.filter(m => {
            if(currentSport==='AT') return m.sp==='AT' || m.sp==='EV';
            return m.sp === currentSport;
        });
        list.sort((a,b) => a.t.localeCompare(b.t));

        if(list.length === 0) {
            container.innerHTML = `<div class="empty-state">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</div>`;
            return;
        }

        let times = [...new Set(list.map(m => m.t))];
        times.forEach(t => {
            let groupDiv = document.createElement('div');
            groupDiv.className = 'match-table-container';
            let html = `<div class="match-header"><i class="far fa-clock"></i> ${t} ‡∏ô.</div>`;
            
            list.filter(m => m.t === t).forEach(m => {
                let spName = getSportName(m.sp);
                let spColor = `var(--c-${m.sp.toLowerCase()})`;
                if(m.sp==='AT' || m.sp==='EV') spColor = 'var(--c-at)';
                
                let s1 = parseInt(m.s1), s2 = parseInt(m.s2);
                let w1 = (s1>s2) ? 'color:#10b981' : '';
                let w2 = (s2>s1) ? 'color:#10b981' : '';
                let status = (m.s1 && m.s2) ? '<i class="fas fa-check-circle done"></i>' : '<i class="far fa-circle"></i>';

                if(m.sp === 'AT' || m.sp === 'EV') {
                    html += `<div class="match-row" style="grid-template-columns: 1fr;">
                        <div style="display:flex; justify-content:space-between;">
                            <div><span class="m-field">${m.f}</span> <b>${m.desc}</b></div>
                        </div>
                    </div>`;
                } else {
                    html += `
                    <div class="match-row">
                        <div class="m-time" style="color:${spColor}">${m.sp}</div>
                        <div class="m-cat">
                            <span class="cat-name">${spName} ${m.lv} ${m.gd}</span>
                            <span class="cat-sub">${m.cat}</span>
                        </div>
                        <div class="m-vs">
                            <span class="t-name t-right" style="${w1}">${m.t1}</span>
                            <div class="score-inputs">
                                <input class="score-inp" type="number" value="${m.s1}" onchange="upd('${m.id}',1,this.value)">:
                                <input class="score-inp" type="number" value="${m.s2}" onchange="upd('${m.id}',2,this.value)">
                            </div>
                            <span class="t-name t-left" style="${w2}">${m.t2}</span>
                        </div>
                        <div class="m-field">${m.f}</div>
                        <div class="m-status">${status}</div>
                    </div>`;
                }
            });
            groupDiv.innerHTML = html;
            container.appendChild(groupDiv);
        });
    }

    function renderStandings() {
        const container = document.getElementById('standings-area');
        container.innerHTML = '';
        if(currentSport === 'ALL' || currentSport === 'AT') {
            container.innerHTML = `<div class="empty-state" style="font-size:0.9rem;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>`; return;
        }

        // Filter Categories
        categories.filter(c => c.sp === currentSport).forEach(cat => {
            // Calc stats
            let stats = {};
            matches.forEach(m => {
                if(m.sp===cat.sp && m.lv===cat.lv && m.gd===cat.gd && m.s1 && m.s2) {
                    let s1=parseInt(m.s1), s2=parseInt(m.s2);
                    if(!stats[m.t1]) stats[m.t1]={P:0,PTS:0}; if(!stats[m.t2]) stats[m.t2]={P:0,PTS:0};
                    stats[m.t1].P++; stats[m.t2].P++;
                    if(s1>s2) stats[m.t1].PTS+=3; else if(s2>s1) stats[m.t2].PTS+=3; else { stats[m.t1].PTS+=1; stats[m.t2].PTS+=1; }
                }
            });

            // Get Teams List
            let teamList = (cat.lv==='SEC') ? secTeams : [...priTeams.A, ...priTeams.B, ...priTeams.C];
            if(cat.lv==='ANU') teamList = ["‡πÇ‡∏ô‡∏ô‡∏°‡πà‡∏ß‡∏á","‡∏ó‡πà‡∏≤‡∏≠‡∏∏‡∏ó‡∏±‡∏¢","‡∏†‡∏π‡∏û‡∏£‡∏∞‡∏Ø","‡πÇ‡∏ô‡∏ô‡∏™‡∏ß‡∏≤‡∏ó‡∏Ø","‡πÇ‡∏ô‡∏ô‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå‡∏Ø","‡∏´‡∏ô‡∏≠‡∏á‡∏Å‡∏∏‡∏á‡∏®‡∏£‡∏µ‡∏Ø","‡πÇ‡∏ô‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á","‡∏î‡πâ‡∏ß‡∏á‡∏Ø-‡∏ä‡∏≥‡∏Ø","‡πÇ‡∏ô‡∏ô‡πÑ‡∏´‡∏°‡∏Ø"]; // Simplified pool

            let sorted = teamList.sort((a,b) => (stats[b]?.PTS||0) - (stats[a]?.PTS||0));

            // Render Table
            let box = document.createElement('div');
            box.className = 'st-box';
            let html = `<div class="st-head">${cat.name}</div>
            <table class="st-table">
                <tr><th>#</th><th>‡∏ó‡∏µ‡∏°</th><th>‡πÅ‡∏Ç‡πà‡∏á</th><th>‡πÅ‡∏ï‡πâ‡∏°</th></tr>
                ${sorted.map((t,i) => {
                    let s = stats[t] || {P:0, PTS:0};
                    return `<tr><td>${i+1}</td><td>${t}</td><td>${s.P}</td><td class="st-pts">${s.PTS}</td></tr>`;
                }).join('')}
            </table>`;
            box.innerHTML = html;
            container.appendChild(box);
        });
    }

    // --- ACTIONS ---
    function switchDay(d) {
        currentDay = d;
        document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        renderSchedule();
    }
    function filterSport(sp) {
        currentSport = sp;
        document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
        event.currentTarget.classList.add('active');
        render();
    }
    function upd(id, slot, val) {
        let m = matches.find(x => x.id === id);
        if(m) { if(slot==1) m.s1=val; else m.s2=val; saveData(); }
    }
    
    // Helpers
    function getSportName(c) { const m={FB:'‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏•',VB:'‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå',TK:'‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠',PT:'‡πÄ‡∏õ‡∏ï‡∏≠‡∏á',AT:'‡∏Å‡∏£‡∏µ‡∏ë‡∏≤',EV:'‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°'}; return m[c]||c; }
    function showToast() { let t=document.getElementById('toast'); t.className='show'; setTimeout(()=>t.className='', 2000); }
    function saveData() { localStorage.setItem('ns_v32_db', JSON.stringify(matches)); }
    function saveDataManual() { saveData(); showToast(); }
    function resetData() { if(confirm('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) { localStorage.removeItem('ns_v32_db'); location.reload(); } }
</script>
</body>
</html>
